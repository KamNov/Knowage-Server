<div class="mapWidgetLegendContainer" draggable="ngModel.style.legend" ng-class="ngModel.style.legend.position" ng-show="needLegend()" ng-style="getLegendContainerStyle()">

	<div class="mapWidgetLegend" ng-style="getLegendSubContainerStyle()">
		<button ng-show="isShowLegend" class="toggleButton" ng-click="hideLegend()"><md-icon md-font-icon="fas fa-chevron-down"></button>
		<span ng-show="!isShowLegend" class="legendLayerLabel" flex>{{translate.load('sbi.cockpit.map.legend.label')}}</span>
		<button  ng-show="!isShowLegend" class="toggleButton" ng-click="showLegend()"><md-icon md-font-icon="fas fa-chevron-up"></md-icon></button>

		<div class="mapWidgteLegendInfo" ng-show="isShowLegend" ng-if="ngModel.style.legend.title.text" ng-style="getLegendTitleStyle()">
			<span>{{ ngModel.style.legend.title.text }}</span>
		</div>

		<div class="mapWidgteLegendInfo" ng-show="isShowLegend" ng-if="ngModel.style.legend.info.text" ng-style="getLegendInfoStyle()">
			<span>{{ ngModel.style.legend.info.text }}</span>
		</div>

		<div class="mapWidgetLegendElementLoop" ng-show="isShowLegend" ng-repeat="legendElem in getLegendEntries() | orderBy:'alias'">
		
			<div ng-style="getLegendSectionContainerStyle()" layout="{{ getLegendDisposition() }}" ng-show="getLayerVisibility(legendElem.layer)" ng-if="legendElem.visualizationType == 'choropleth' && legendElem.method != 'CLASSIFY_BY_RANGES'">
				<span class="legendLayerLabel" ng-style="getLegendSpanElementsStyle()">{{legendElem.alias}}</span>

				<div layout="row" ng-style="getLegendElementsStyle()" ng-if="ngModel.style.legend.visualizationType != 'Range'">
					<span class="legendStartLimit">{{legendElem.classification[0].from_label}}</span>
					<div class="mapWidgetLegendGradient" ng-style="{ background: 'linear-gradient(to right, ' + legendElem.classification[0].color + ', ' + legendElem.classification[legendElem.classification.length-1].color + ')' }"></div>
					<span class="legendEndLimit">{{legendElem.classification[legendElem.classification.length-1].to_label}}</span>
				</div>

				<div layout="row" ng-style="getLegendElementsStyle()" ng-if="ngModel.style.legend.visualizationType == 'Range'" ng-repeat="classification in legendElem.classification">
					<div class="mapWidgetLegendDot" ng-style="{ background: classification.color }"></div>
					<div style="font-size:small;margin-left:5px;margin-right:5px;">[{{classification.from_label}}-{{classification.to_label}}]</div>
				</div>
			</div>

			<div ng-style="getLegendSectionContainerStyle()" layout="{{ getLegendDisposition() }}" ng-show="getLayerVisibility(legendElem.layer)" ng-if="legendElem.visualizationType == 'choropleth' && legendElem.method == 'CLASSIFY_BY_RANGES'">
				<span class="legendLayerLabel" ng-style="getLegendSpanElementsStyle()">{{legendElem.alias}}</span>
				<div layout="row" ng-style="getLegendElementsStyle()" ng-repeat="classification in legendElem.classification">
					<div class="mapWidgetLegendDot" ng-style="{ background: classification.color }"></div>
					<div style="font-size:small;margin-left:5px;margin-right:5px;">[{{classification.from_label}}-{{classification.to_label}}]</div>
				</div>
			</div>

			<div ng-style="getLegendSectionContainerStyle()" layout="{{ getLegendDisposition() }}" ng-show="getLayerVisibility(legendElem.layer)" ng-if="legendElem.visualizationType == 'balloons'">
				<span class="legendLayerLabel" ng-style="getLegendSpanElementsStyle()">{{legendElem.alias}}</span>
				<div layout="row" ng-style="getLegendElementsStyle()" ng-repeat="classification in legendElem.classification" style="margin: 0 3px;">
					<svg height="{{ classification.dimension + 2 }}" width="{{ classification.dimension + 2 }}" ng-style="{ position: 'relative', top: 3 }">
						<circle cx="{{ (classification.dimension / 2) + 1 }}" cy="{{ (classification.dimension / 2) + 1 }}" r="{{ classification.dimension / 2 }}" ng-style="{ 'fill': classification.color, 'stroke': classification.borderColor, 'stroke-width': '1px' }"/>
					</svg>
					<span class="legendStartLimit">[{{classification.from_label}}-{{classification.to_label}}]</span>
				</div>
			</div>

			<div ng-style="getLegendSectionContainerStyle()" layout="{{ getLegendDisposition() }}" ng-show="getLayerVisibility(legendElem.layer)" ng-if="legendElem.visualizationType == 'pies'">
				<span class="legendLayerLabel" ng-style="getLegendSpanElementsStyle()">{{legendElem.alias}}</span>
				<div layout="row" ng-style="getLegendElementsStyle()" ng-repeat="classification in legendElem.classification">
					<svg height="20" width="20">
						<path d="M 18 16 A 18 18 0 0 0 8 2 L 2 18 Z" ng-style="{ 'fill': classification.color, 'stroke': classification.borderColor, 'stroke-width': '1px' }"/>
					</svg>
					<div style="font-size:small;margin-left:5px;margin-right:5px;">{{ classification.category }}</div>
				</div>
			</div>

		</div>
	</div>

</div>